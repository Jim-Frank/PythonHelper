<html> 
<head> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 
<script src="http://www.skulpt.org/static/skulpt.min.js" type="text/javascript"></script> 
<script src="http://www.skulpt.org/static/skulpt-stdlib.js" type="text/javascript"></script> 
<script src="codemirror/lib/codemirror.js"></script>
<script src="codemirror/lib/python.js"></script>
<script src="codemirror/lib/matchbrackets.js"></script>
<link rel="stylesheet" href="codemirror/lib/codemirror.css">
</head> 

<body> 

<div>
    <textarea id="code">4*4</textarea>
</div>
<div>
    <textarea readonly id="code_checker" style="display: none;">self.assertEqual(add(2,2),4,"A feedback string when the test fails")</textarea>
</div>
<div class="row">
    <button type="button" onclick="runit()">Run</button>
</div>
<div class="row">
    <pre id="output"></pre>
    <div id="mycanvas"></div>
</div>
<script type="text/javascript">
    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
        mode: "python",
        styleActiveLine: true,
        lineNumbers: true,
        lineWrapping: false,
        indentUnit: 4,
        matchBrackets: true,
        autoMatchParens: true,
        extraKeys: {
            "Tab": "indentMore",
            "Shift-Tab": "indentLess"
        }
    });

    function outf(text) {
        var mypre = document.getElementById("output");
        mypre.innerHTML = mypre.innerHTML + text;
    }
    function builtinRead(x) {
        if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
            throw "File not found: '" + x + "'";
        return Sk.builtinFiles["files"][x];
    }

    function runit() {
        var prog = editor.getValue();
        var code_checker = document.getElementById('code_checker').value;
        // Get code from editor, add a new line, append code_checker for checking user submission
        prog = prog + '\n' + code_checker;
        var mypre = document.getElementById("output");
        mypre.innerHTML = '';
        Sk.pre = "output";
        Sk.configure({output: outf, read: builtinRead});
        (Sk.TurtleGraphics || (Sk.TurtleGraphics = {})).target = 'mycanvas';
        var myPromise = Sk.misceval.asyncToPromise(function () {
            return Sk.importMainWithBody("<stdin>", false, prog, true);
        });
        myPromise.then(function (mod) {
                    console.log('success');
                },
                function (err) {
                    console.log(err.toString());
                });
    }
</script>

</body> 

</html> 